cmake_minimum_required(VERSION 3.0.0)
project(lightssl VERSION 0.1.0)

include(CTest)
enable_testing()

set(CMAKE_CONFIGURATION_TYPES Release)

# Pthread
set(CMAKE_THREAD_PREFER_PTHREAD TRUE)
set(THREADS_PREFER_PTHREAD_FLAG TRUE)
find_package(Threads REQUIRED)

set(CMAKE_C_FLAGS "${CMAKE_C_FLAGS} -std=c99 -Wno-unused-variable -Wno-unused-function -Wall -Wextra -Wno-unused-parameter -pedantic -pthread ")

add_library(lighthash OBJECT src/lighthash.c)
add_library(lightkeys OBJECT src/lightkeys.c)
add_library(lightcrypto OBJECT src/lightcrypto.c)
add_library(lightciphers OBJECT src/lightciphers.c)

add_executable(test_hash3 src/tests/test_lighthash3.c)
add_executable(test_ciphers src/tests/test_lightciphers.c)
add_executable(test_crypto src/tests/test_lightcrypto.c)
add_executable(test_keys src/tests/test_lightkeys.c)
add_executable(test_hash_hmac0 src/tests/test_lighthash_hmac0.c)
add_executable(test_hash_hmac1 src/tests/test_lighthash_hmac1.c)
add_executable(test_hash_hmac2 src/tests/test_lighthash_hmac2.c)
add_executable(test_hash_hmac3 src/tests/test_lighthash_hmac3.c)
add_executable(test_hash_hmac4 src/tests/test_lighthash_hmac4.c)
add_executable(test_hash_sha0 src/tests/test_lighthash_sha0.c)
add_executable(test_hash_sha1 src/tests/test_lighthash_sha1.c)
add_executable(test_hash_sha2 src/tests/test_lighthash_sha2.c)
add_executable(test_hash_sha3 src/tests/test_lighthash_sha3.c)
add_executable(test_hash_sha4 src/tests/test_lighthash_sha4.c)

target_link_libraries(test_hash3 PUBLIC lighthash PRIVATE m)
target_link_libraries(test_ciphers PUBLIC lightciphers PRIVATE m)
target_link_libraries(test_crypto PUBLIC lightcrypto PRIVATE m)
target_link_libraries(test_keys PUBLIC lightkeys PRIVATE m)
target_link_libraries(test_hash_hmac0 PUBLIC lighthash PRIVATE m)
target_link_libraries(test_hash_hmac1 PUBLIC lighthash PRIVATE m)
target_link_libraries(test_hash_hmac2 PUBLIC lighthash PRIVATE m)
target_link_libraries(test_hash_hmac3 PUBLIC lighthash PRIVATE m)
target_link_libraries(test_hash_hmac4 PUBLIC lighthash PRIVATE m)
target_link_libraries(test_hash_sha0 PUBLIC lighthash PRIVATE m)
target_link_libraries(test_hash_sha1 PUBLIC lighthash PRIVATE m)
target_link_libraries(test_hash_sha2 PUBLIC lighthash PRIVATE m)
target_link_libraries(test_hash_sha3 PUBLIC lighthash PRIVATE m)
target_link_libraries(test_hash_sha4 PUBLIC lighthash PRIVATE m)

add_test(NAME test_hash3 COMMAND test_hash3)
add_test(NAME test_ciphers COMMAND test_ciphers)
add_test(NAME test_crypto COMMAND test_crypto)
add_test(NAME test_keys COMMAND test_keys)
add_test(NAME test_hash_hmac0 COMMAND test_hash_hmac0)
add_test(NAME test_hash_hmac1 COMMAND test_hash_hmac1)
add_test(NAME test_hash_hmac2 COMMAND test_hash_hmac2)
add_test(NAME test_hash_hmac3 COMMAND test_hash_hmac3)
add_test(NAME test_hash_hmac4 COMMAND test_hash_hmac4)
add_test(NAME test_hash_sha0 COMMAND test_hash_sha0)
add_test(NAME test_hash_sha1 COMMAND test_hash_sha1)
add_test(NAME test_hash_sha2 COMMAND test_hash_sha2)
add_test(NAME test_hash_sha3 COMMAND test_hash_sha3)
add_test(NAME test_hash_sha4 COMMAND test_hash_sha4)

set(CPACK_PROJECT_NAME ${PROJECT_NAME})
set(CPACK_PROJECT_VERSION ${PROJECT_VERSION})
include(CPack)
